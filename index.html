<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cronômetro — 2:30</title>

  <style>
    :root{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;}

    body{
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:30px;
      padding:20px;
      min-height:100vh;
      background:#f4f6fb;
      margin:0;
      color:#0f172a;
    }

    /* CARD DO CRONÔMETRO */
    .card{
      background:#fff;
      border-radius:12px;
      box-shadow:0 6px 20px rgba(15,23,42,0.08);
      padding:28px;
      width:420px;
      text-align:center;
    }

    .time{font-size:64px;font-weight:700;letter-spacing:1px;margin:6px 0}

    .controls{display:flex;gap:10px;justify-content:center;margin-top:16px}

    button{
      padding:10px 14px;border-radius:10px;border:0;font-weight:600;
      cursor:pointer;box-shadow:0 2px 6px rgba(2,6,23,0.06)
    }
    button.primary{background:#0ea5a4;color:white}
    button.ghost{background:#eef2ff;color:#3730a3}
    button.warn{background:#fde68a;color:#92400e}

    .marks{margin-top:20px;text-align:left}
    .marks h3{margin:0 0 8px 0;font-size:14px;color:#334155}

    .mark-list{
      list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px
    }

    .mark{
      padding:8px 10px;border-radius:8px;background:#f8fafc;
      border:1px solid rgba(2,6,23,0.04);
      display:flex;justify-content:space-between;align-items:center;
      font-weight:600
    }

    .small{font-size:13px;color:#475569;font-weight:500}

    footer{margin-top:12px;font-size:12px;color:#64748b}

    /* LISTA DE MÚSICAS */
    .music-card{
      background:white;
      width:280px;
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 20px rgba(15,23,42,0.08);
      height:fit-content;
    }

    .music-card h2{
      font-size:20px;
      margin-top:0;
      text-align:center;
      color:#0f172a;
    }

    .music-list{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .music-item{
      background:#f8fafc;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid rgba(2,6,23,0.04);
      cursor:pointer;
      transition:0.2s;
    }

    .music-item:hover{
      background:#e0f7f7;
      transform:scale(1.02);
    }

    .music-item strong{color:#0ea5a4}
  </style>
</head>



<body>

  <!-- ================= CARD DO CRONÔMETRO ================= -->
  <div class="card">
    <h2>Cronômetro — 2:30 (contagem regressiva)</h2>

    <div id="display" class="time">02:30</div>

    <div class="controls">
      <button id="startPause" class="primary">Iniciar</button>
      <button id="reset" class="ghost">Reset</button>
      <button id="mark" class="warn">Marcar</button>
    </div>

    <div class="marks">
      <h3>Marcas</h3>
      <ul id="markList" class="mark-list"></ul>
    </div>

    <button id="export" class="primary" style="margin-top:15px; width:100%;">Exportar para Excel</button>
    <button id="goCalc" class="ghost" style="margin-top:10px; width:100%;">Ir para Calculadora</button>

    <footer>Marcas registram o tempo entre eventos.</footer>
  </div>



  <!-- ================= LISTA DE MÚSICAS ================= -->
  <div class="music-card">
    <h2>Músicas dos Integrantes</h2>

    <ul class="music-list">

      <!-- EXEMPLOS — EDITE AQUI -->
      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=bWSn9jL1g7I&list=RDbWSn9jL1g7I&start_radio=1')">
        <strong>Deivid:</strong> Burguesinha
      </li>

      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=NwzlyWr9fAM&list=RDNwzlyWr9fAM&start_radio=1')">
        <strong>Perez:</strong> Complicada
      </li>

      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=E5HLF92vf9U&list=RDE5HLF92vf9U&start_radio=1')">
        <strong>Ramos:</strong> She's A Lover
      </li>

      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=3JZ4pnNtyxQ')">
        <strong>Isabela:</strong> Counting Stars
      </li>

      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=P-lxOj0XpEE&list=RDP-lxOj0XpEE&start_radio=1')">
        <strong>Izadora:</strong> Oceano
      </li>

      <li class="music-item" onclick="openMusic('https://www.youtube.com/watch?v=3-qwqrQXsXQ&list=RD3-qwqrQXsXQ&start_radio=1')">
        <strong>Jean:</strong> Samurai
      </li>

    </ul>
  </div>



<script>
function openMusic(url){
  window.open(url, "_blank");
}

(function(){
  const initialSeconds = 2*60 + 30;
  let remaining = initialSeconds;
  let running = false;
  let lastTick = null;
  let rafId = null;

  const display = document.getElementById('display');
  const startPauseBtn = document.getElementById('startPause');
  const resetBtn = document.getElementById('reset');
  const markBtn = document.getElementById('mark');
  const markList = document.getElementById('markList');
  const exportBtn = document.getElementById('export');
  const goCalcBtn = document.getElementById('goCalc');

  const countdownAudio = new Audio("Cronometro Para FLL Com Narração.m4a");
  let isCountdownRunning = false;

  let nextType = 'Saída';
  let lancamentoCount = 1;
  let trocaCount = 1;
  let lastElapsed = 0;

  const marks = [];

  function formatTime(s){
    s = Math.max(0, Math.round(s));
    const mm = String(Math.floor(s/60)).padStart(2,'0');
    const ss = String(s % 60).padStart(2,'0');
    return `${mm}:${ss}`;
  }

  function render(){ display.textContent = formatTime(remaining); }

  function tick(now){
    if(!running) return;
    if(!lastTick) lastTick = now;
    const delta = (now - lastTick)/1000;
    lastTick = now;
    remaining -= delta;
    if(remaining <= 0){
      remaining = 0;
      running = false;
      startPauseBtn.textContent = 'Iniciar';
    }
    render();
    if(running) rafId = requestAnimationFrame(tick);
  }

  async function startCountdownBeforeTimer(){
    isCountdownRunning = true;
    countdownAudio.currentTime = 0;
    countdownAudio.play();

    for (let n = 5; n >= 1; n--) {
      if (!isCountdownRunning) return;
      display.textContent = n;
      await new Promise(r => setTimeout(r, 1000));
    }

    if (!isCountdownRunning) return;

    render();
    isCountdownRunning = false;
  }

  startPauseBtn.addEventListener('click', async ()=>{

    if(!running && remaining === initialSeconds){
      startPauseBtn.textContent = "Pausar";
      await startCountdownBeforeTimer();
    }

    running = !running;

    if(running){
      startPauseBtn.textContent = 'Pausar';
      lastTick = null;
      rafId = requestAnimationFrame(tick);
    } else {
      startPauseBtn.textContent = 'Iniciar';
      if(rafId) cancelAnimationFrame(rafId);
      lastTick = null;
    }
  });

  resetBtn.addEventListener('click', ()=>{
    isCountdownRunning = false;

    countdownAudio.pause();
    countdownAudio.currentTime = 0;

    running = false;
    remaining = initialSeconds;

    if(rafId) cancelAnimationFrame(rafId);
    rafId = null;
    lastTick = null;

    startPauseBtn.textContent = 'Iniciar';
    render();

    markList.innerHTML = '';
    marks.length = 0;

    lancamentoCount = 1;
    trocaCount = 1;
    nextType = 'Saída';
    lastElapsed = 0;
  });

  markBtn.addEventListener('click', ()=>{
    const elapsedTotal = Math.floor(initialSeconds - Math.max(0, remaining));
    let deltaSeconds = elapsedTotal - lastElapsed;
    if(deltaSeconds < 0) deltaSeconds = 0;

    const number = (nextType === 'Saída') ? lancamentoCount : trocaCount;
    const timeLabel = formatTime(Math.max(0, Math.round(remaining)));

    const li = document.createElement('li');
    li.className = 'mark';
    li.innerHTML =
      `<span class="small"><strong>${nextType} ${number}</strong> — ${deltaSeconds}s desde a última marca</span>
       <span class="small">restante ${timeLabel}</span>`;
    markList.append(li);

    marks.push({ tipo: nextType, numero: number, desdeUltimaSegundos: deltaSeconds });

    lastElapsed = elapsedTotal;

    if(nextType === 'Saída'){
      lancamentoCount++;
      nextType = 'Troca de anexo';
    } else {
      trocaCount++;
      nextType = 'Saída';
    }
  });

  exportBtn.addEventListener('click', ()=>{
    if (marks.length === 0) return alert('Nenhuma marca para exportar');

    let totalSaidas = 0;
    let totalTrocas = 0;

    marks.forEach(m=>{
      if(m.tipo==="Saída") totalSaidas+=m.desdeUltimaSegundos;
      else totalTrocas+=m.desdeUltimaSegundos;
    });

    let csv = "Tipo;TempoTotal(s)\n";
    csv += `Saídas;${totalSaidas}\n`;
    csv += `Trocas de anexo;${totalTrocas}\n`;

    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'cronometro_totais.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  goCalcBtn.addEventListener('click', ()=>{
    let totalSaidas = 0;
    let totalTrocas = 0;

    marks.forEach(m=>{
      if(m.tipo==="Saída") totalSaidas+=m.desdeUltimaSegundos;
      else totalTrocas+=m.desdeUltimaSegundos;
    });

    localStorage.setItem("totalSaidas", totalSaidas);
    localStorage.setItem("totalTrocas", totalTrocas);

    window.location.href = "calculadora.html";
  });

  render();
})();
</script>
</body>
</html>
